namespace = z_item_crafting_menu

# Main Menu, USE ITEM, GIFT ITEM
character_event = {
	id = z_item_crafting_menu.0
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:magic_caster = {
			magic_points_setup = yes
		}
		character_event = {
			id = z_item_crafting_menu.1
		}
	}
}

character_event = {
	id = z_item_crafting_menu.1
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = 0
			}
			set_variable = {
				which = "d_action_cancel" value = 0
			}
			set_variable = {
				which = "action_picked" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_items" value = 0
			}
			set_variable = {
				which = "d_action_craft_weapon" value = 0
			}
			set_variable = {
				which = "d_action_craft_crown" value = 0
			}
			set_variable = {
				which = "d_action_craft_wrist" value = 0
			}
			set_variable = {
				which = "d_action_craft_neck" value = 0
			}
			set_variable = {
				which = "d_action_craft_torso" value = 0
			}
			set_variable = {
				which = "d_action_craft_banner" value = 0
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = "0"
			}
			set_variable = {
				which = "action_picked" value = "1"
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_weapon" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_wrist" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_neck" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_torso" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_crown" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_items" which = "action_nr"
				}
			}
		}
		long_character_event = {
			id = z_item_crafting_menu.2
		}
	}
}

long_character_event = {
	id = z_item_crafting_menu.2
	title = "Item Crafting"
	# лол надо перенести в файл локализации
	desc = "Of the many arts unique to the mage, none is perhaps more profound than the crafting of enchanted items. Unlike spells and rituals of power, the crafting of an item creates a persisting legacy of profound capability, capable of being wielded not just by the few for whom magic is a part of their blood, but any with the will and the heart to stand forth."
	picture = "GFX_evt_mage_choose_lore"
	is_triggered_only = yes

	trigger = {
		event_target:item_crafter = {
			is_alive = yes
		}
	}
	# next action

	option = {
		name = "NEXT_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" which = "action_nr"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" value = 1
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.2
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" which = "action_nr"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = 1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.2
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 1
		}
	}
	# previous action

	option = {
		name = "PREVIOUS_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" value = "1"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = -1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.2
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" value = "1"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" which = "action_nr"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.2
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "Weapon Crafting"
		custom_tooltip = {
			text = "Engage in the crafting of a weapon ensorcelled with powerful sorceries. These weapons will greatly empower your combat ability."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_weapon"
				}
			}
		}
		character_event = {
			id = z_item_crafting_menu.21
		}
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Gauntlet Crafting"
		custom_tooltip = {
			text = "Engage in the crafting of a potent enchanted ring. These rings carry the most significant bonuses to your characters attributes."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_wrist"
				}
			}
		}
		character_event = {
			id = z_item_crafting_menu.31
		}
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Necklace Crafting"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic amulet, these items will boost your character's attributes."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_neck"
				}
			}
		}
		character_event = {
			id = z_item_crafting_menu.41
		}
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Armour Crafting"
		custom_tooltip = {
			text = "Engage in the crafting of enchanted armour. These suits of armour will increase your defenses while dueling."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_torso"
				}
			}
		}
		character_event = {
			id = z_item_crafting_menu.51
		}
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Crown Crafting"
		custom_tooltip = {
			text = "Engage in the crafting of a enchanted helm. These helms will affect your character with a attribute boosts and increased defense in dueling."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_crown"
				}
			}
		}
		character_event = {
			id = z_item_crafting_menu.61
		}
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Banner Crafting"
		custom_tooltip = {
			text = "Engage in the crafting of a potent enchanted banner. These banners will boost your armies raw performance in combat."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_banner"
				}
			}
		}
		character_event = {
			id = z_item_crafting_menu.71
		}
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Magic Item Crafting"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic item. These items will profoundly affect your spell casting capabilities."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_items"
				}
			}
		}
		character_event = {
			id = z_item_crafting_menu.11
		}
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "I don't want to craft at this time"
		event_target:item_crafter = {
			clr_character_flag = casting
			character_event = {
				id = magic_system.99997
			}
		}
		ai_chance = {
			factor = 10
		}
	}
}

# Item Crafting Magic Items
character_event = {
	id = z_item_crafting_menu.11
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = 0
			}
			set_variable = {
				which = "d_action_cancel" value = 0
			}
			set_variable = {
				which = "action_picked" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_ring" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_amulet" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_staff" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_robes" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_spellbook" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_crown" value = 0
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = "0"
			}
			set_variable = {
				which = "action_picked" value = "1"
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_ring" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_staff" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_amulet" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_robes" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
 					check_variable = {
						which = "caster_level" value = "6"
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_spellbook" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
					check_variable = {
						which = "caster_level" value = "6"
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_crown" which = "action_nr"
				}
			}
		}
		long_character_event = {
			id = z_item_crafting_menu.12
		}
	}
}

long_character_event = {
	id = z_item_crafting_menu.12
	title = "Arcane Spell Casting"
	desc = "Arcane Magic, perhaps the most profound force in existance. This kind of power is one that rapidly exceeds the imagination and capability of many, unleashing unto the world forces at the limit's of comprehension."
	picture = "GFX_evt_mage_choose_lore"
	is_triggered_only = yes

	trigger = {
		event_target:item_crafter = {
			is_alive = yes
		}
	}
	# next action

	option = {
		name = "NEXT_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" which = "action_nr"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" value = 1
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.12
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" which = "action_nr"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = 1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.12
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 1
		}
	}
	# previous action

	option = {
		name = "PREVIOUS_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" value = "1"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = -1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.12
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" value = "1"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" which = "action_nr"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.12
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "Craft Magic Ring"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic ring, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_ring"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_ring_3
					}
				}
				2 = {
					event_target:item_recipient = {
						add_artifact = mages_ring_2
					}
				}
				3 = {
					event_target:item_recipient = {
						add_artifact = mages_ring_1
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Magic Staff"
		custom_tooltip = {
			text = "Engage in the crafting of a potent Magic Staff, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_staff"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_staff_3
					}
				}
				2 = {
					event_target:item_recipient = {
						add_artifact = mages_staff_2
					}
				}
				3 = {
					event_target:item_recipient = {
						add_artifact = mages_staff_1
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Magic Amulet"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic amulet, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_amulet"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_amulet_3
					}
				}
				2 = {
					event_target:item_recipient = {
						add_artifact = mages_amulet_2
					}
				}
				3 = {
					event_target:item_recipient = {
						add_artifact = mages_amulet_1
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Mages Robes"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic amulet, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_robes"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_robes_3
					}
				}
				2 = {
					event_target:item_recipient = {
						add_artifact = mages_robes_2
					}
				}
				3 = {
					event_target:item_recipient = {
						add_artifact = mages_robes_1
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Magic Spell Book"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic spell book, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_spellbook"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_tome
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Mages Crown"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic spell book, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_crown"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_crown
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Retun to Crafting Menu"
		character_event = {
			id = z_item_crafting_menu.0
		}
		ai_chance = {
			factor = 1
		}
	}
}

# Item Crafting Weapons
character_event = {
	id = z_item_crafting_menu.21
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = 0
			}
			set_variable = {
				which = "d_action_cancel" value = 0
			}
			set_variable = {
				which = "action_picked" value = 0
			}
			set_variable = {
				which = "d_action_craft_sword_1" value = 0
			}
			set_variable = {
				which = "d_action_craft_sword_2" value = 0
			}
			set_variable = {
				which = "d_action_craft_sword_3" value = 0
			}
			set_variable = {
				which = "d_action_craft_sword_4" value = 0
			}
			set_variable = {
				which = "d_action_craft_sword_5" value = 0
			}
			set_variable = {
				which = "d_action_craft_sword_6" value = 0
			}
			set_variable = {
				which = "d_action_craft_warrior_bane" value = 0
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = "0"
			}
			set_variable = {
				which = "action_picked" value = "1"
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_sword_1" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_sword_2" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_sword_3" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_sword_4" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_sword_5" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_sword_6" which = "action_nr"
				}
			}
		}
		long_character_event = {
			id = z_item_crafting_menu.22
		}
	}
}

long_character_event = {
	id = z_item_crafting_menu.22
	title = "Craft Enchanted Swords"
	desc = "The Crafting of Enchanted blades remains one of the singlemost important tasks for all mages of the realm. By equipping the knights and lords of the realm with enchanted armaments, the mages and sorcerers of the realm ensure the defence by force of arms."
	picture = "GFX_evt_mage_choose_lore"
	is_triggered_only = yes

	trigger = {
		event_target:item_crafter = {
			is_alive = yes
		}
	}
	# next action

	option = {
		name = "NEXT_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" which = "action_nr"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" value = 1
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.22
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" which = "action_nr"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = 1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.22
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 1
		}
	}
	# previous action

	option = {
		name = "PREVIOUS_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" value = "1"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = -1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.22
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" value = "1"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" which = "action_nr"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.22
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "Craft Sword of Resolute Action"
		custom_tooltip = {
			text = "Engage in the crafting of one of the enchanted blades of resolute action. These noble and glorious weapons, bring forth the inherent nobility ahd character of their wielder, better ensuring the just and right outcome."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_sword_1"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = relic_sword
					}
				}
				2 = {
					event_target:item_recipient = {
						add_artifact = goldsigil_sword
					}
				}
				3 = {
					event_target:item_recipient = {
						add_artifact = sword_of_battle
					}
				}
				4 = {
					event_target:item_recipient = {
						add_artifact = giant_blade
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Sword of Swiftness"
		custom_tooltip = {
			text = "Engage in the crafting of a potent enchanted blade of Swiftness. These blades excell in swift movements, and can greatly increase the speed at which you can defeat your foes."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_sword_2"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = sword_of_striking
					}
				}
				2 = {
					event_target:item_recipient = {
						add_artifact = sword_of_swiftslaying
					}
				}
				3 = {
					event_target:item_recipient = {
						add_artifact = fencers_blades
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Sword of Shadowed Striking"
		custom_tooltip = {
			text = "Engage in the crafting of a potent enchanted blade of the shadows. These blades carry enchantments that bolster their ability to strike from an unknown corner."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_sword_3"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = tormentor_sword
					}
				}
				2 = {
					event_target:item_recipient = {
						add_artifact = biting_blade
					}
				}
				3 = {
					event_target:item_recipient = {
						add_artifact = sword_of_antiheroes
					}
				}
				4 = {
					event_target:item_recipient = {
						add_artifact = sword_of_strife
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Sword of Bloodshed"
		custom_tooltip = {
			text = "Engage in the crafting of a potent sword, reeking in the blood that it will shed, and the horrors it will spread."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_sword_4"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = sword_of_bloodshed
					}
				}
				2 = {
					event_target:item_recipient = {
						add_artifact = berserker_sword
					}
				}
				3 = {
					event_target:item_recipient = {
						add_artifact = shrieking_blade
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Sword of Strength"
		custom_tooltip = {
			text = "Engage in the crafting of a potent blade, enchanted to channel the strength of the beasts!."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_sword_5"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = sword_of_might
					}
				}
				2 = {
					event_target:item_recipient = {
						add_artifact = warrior_bane
					}
				}
				3 = {
					event_target:item_recipient = {
						add_artifact = ogre_blade
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Spell-Thieving Sword"
		custom_tooltip = {
			text = "Engage in the crafting of a potent sword, that steals from it's victims the very energy of their sorcery."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_sword_6"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = spellthieving_sword
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Retun to Crafting Menu"
		character_event = {
			id = z_item_crafting_menu.0
		}
		ai_chance = {
			factor = 1
		}
	}
}

# Item Crafting Wrist
character_event = {
	id = z_item_crafting_menu.31
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = 0
			}
			set_variable = {
				which = "d_action_cancel" value = 0
			}
			set_variable = {
				which = "action_picked" value = 0
			}
			set_variable = {
				which = "d_action_craft_ring_of_speed" value = 0
			}
			set_variable = {
				which = "d_action_craft_ring_of_command" value = 0
			}
			set_variable = {
				which = "d_action_craft_ring_of_invisibility" value = 0
			}
			set_variable = {
				which = "d_action_craft_ring_of_persuasion" value = 0
			}
			set_variable = {
				which = "d_action_craft_ring_of_insight" value = 0
			}
			set_variable = {
				which = "d_action_craft_ring_of_luck" value = 0
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = "0"
			}
			set_variable = {
				which = "action_picked" value = "1"
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_ring_of_speed" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_ring_of_command" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_ring_of_invisibility" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_ring_of_persuasion" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_ring_of_luck" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_ring_of_insight" which = "action_nr"
				}
			}
		}
		long_character_event = {
			id = z_item_crafting_menu.32
		}
	}
}

long_character_event = {
	id = z_item_crafting_menu.32
	title = "Craft Enchanted Ring"
	desc = "The crafting of enchanted items is one of the most profound and arcane secrets preserved by the various magicals of the world. Enchanted rings stand out as one of the most potent sources of personal enhancement availiable."
	picture = "GFX_evt_mage_choose_lore"
	is_triggered_only = yes

	trigger = {
		event_target:item_crafter = {
			is_alive = yes
		}
	}
	# next action

	option = {
		name = "NEXT_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" which = "action_nr"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" value = 1
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.32
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" which = "action_nr"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = 1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.32
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 1
		}
	}
	# previous action

	option = {
		name = "PREVIOUS_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" value = "1"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = -1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.32
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" value = "1"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" which = "action_nr"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.32
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "Craft Ring of Speed"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic ring, This item will boost your ability to get your army into position."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_ring_of_speed"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = ring_of_speed
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Ring of Command"
		custom_tooltip = {
			text = "Engage in the crafting of a potent enchanted Ring, this item will boost your martial ability profoundly."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_ring_of_command"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = ring_of_command
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Ring of Invisibility"
		custom_tooltip = {
			text = "Engage in the crafting of a potent enchanted ring, this item will boost your intrigue attribute profoundly."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_ring_of_invisibility"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = ring_of_invisibility
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Ring of Persuasion"
		custom_tooltip = {
			text = "Engage in the crafting of a potent enchanted ring, This ring will boost your diplomacy attribute profoundly."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_ring_of_persuasion"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = ring_of_persuasion
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Ring of Luck"
		custom_tooltip = {
			text = "Engage in the crafting of a potent enchanted ring, This ring will boost your stewardship attribute profoundly."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_ring_of_luck"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = ring_of_luck
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Ring of Insight"
		custom_tooltip = {
			text = "Engage in the crafting of a potent enchanted ring, This ring will boost your learning attribute profoundly."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_ring_of_insight"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = ring_of_insight
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Retun to Crafting Menu"
		character_event = {
			id = z_item_crafting_menu.0
		}
		ai_chance = {
			factor = 1
		}
	}
}

# Item Crafting Neck
character_event = {
	id = z_item_crafting_menu.41
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = 0
			}
			set_variable = {
				which = "d_action_cancel" value = 0
			}
			set_variable = {
				which = "action_picked" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_ring" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_amulet" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_staff" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_spellbook" value = 0
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = "0"
			}
			set_variable = {
				which = "action_picked" value = "1"
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_ring" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_spellbook" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_staff" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_amulet" which = "action_nr"
				}
			}
		}
		long_character_event = {
			id = z_item_crafting_menu.42
		}
	}
}

long_character_event = {
	id = z_item_crafting_menu.42
	title = "Arcane Spell Casting"
	desc = "Arcane Magic, perhaps the most profound force in existance. This kind of power is one that rapidly exceeds the imagination and capability of many, unleashing unto the world forces at the limit's of comprehension."
	picture = "GFX_evt_mage_choose_lore"
	is_triggered_only = yes

	trigger = {
		event_target:item_crafter = {
			is_alive = yes
		}
	}
	# next action

	option = {
		name = "NEXT_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" which = "action_nr"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" value = 1
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.42
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" which = "action_nr"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = 1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.42
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 1
		}
	}
	# previous action

	option = {
		name = "PREVIOUS_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" value = "1"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = -1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.42
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" value = "1"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" which = "action_nr"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.42
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "Craft Magic Ring"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic ring, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_ring"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_ring_3
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Magic Staff"
		custom_tooltip = {
			text = "Engage in the crafting of a potent Magic Staff, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_staff"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_staff_3
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Magic Amulet"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic amulet, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_amulet"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_amulet_3
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Magic Spell Book"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic spell book, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_spellbook"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_spellbook_3
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Retun to Crafting Menu"
		character_event = {
			id = z_item_crafting_menu.0
		}
		ai_chance = {
			factor = 1
		}
	}
}

# Item Crafting Torso
character_event = {
	id = z_item_crafting_menu.51
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = 0
			}
			set_variable = {
				which = "d_action_cancel" value = 0
			}
			set_variable = {
				which = "action_picked" value = 0
			}
			set_variable = {
				which = "d_action_craft_armour_of_destiny" value = 0
			}
			set_variable = {
				which = "d_action_craft_armour_of_silvered_steel" value = 0
			}
			set_variable = {
				which = "d_action_craft_armour_of_fortune" value = 0
			}
			set_variable = {
				which = "d_action_craft_gamblers_armour" value = 0
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = "0"
			}
			set_variable = {
				which = "action_picked" value = "1"
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_armour_of_destiny" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_armour_of_silvered_steel" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_armour_of_fortune" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_gamblers_armour" which = "action_nr"
				}
			}
		}
		long_character_event = {
			id = z_item_crafting_menu.52
		}
	}
}

long_character_event = {
	id = z_item_crafting_menu.52
	title = "Arcane Spell Casting"
	desc = "Arcane Magic, perhaps the most profound force in existance. This kind of power is one that rapidly exceeds the imagination and capability of many, unleashing unto the world forces at the limit's of comprehension."
	picture = "GFX_evt_mage_choose_lore"
	is_triggered_only = yes

	trigger = {
		event_target:item_crafter = {
			is_alive = yes
		}
	}
	# next action

	option = {
		name = "NEXT_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" which = "action_nr"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" value = 1
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.52
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" which = "action_nr"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = 1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.52
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 1
		}
	}
	# previous action

	option = {
		name = "PREVIOUS_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" value = "1"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = -1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.52
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" value = "1"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" which = "action_nr"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.52
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "Craft Armour of Destiny"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic ring, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_armour_of_destiny"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = armour_of_destiny
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Armour of Silvered Steel"
		custom_tooltip = {
			text = "Engage in the crafting of a potent Magic Staff, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_armour_of_silvered_steel"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = armour_of_silvered_steel
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Armour of Fortune"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic amulet, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_armour_of_fortune"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = armour_of_fortune
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Armour of the Gambler"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic spell book, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_gamblers_armour"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = gamblers_armour
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Retun to Crafting Menu"
		character_event = {
			id = z_item_crafting_menu.0
		}
		ai_chance = {
			factor = 1
		}
	}
}

# Item Crafting Crown
character_event = {
	id = z_item_crafting_menu.61
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = 0
			}
			set_variable = {
				which = "d_action_cancel" value = 0
			}
			set_variable = {
				which = "action_picked" value = 0
			}
			set_variable = {
				which = "d_action_craft_helm_of_discord" value = 0
			}
			set_variable = {
				which = "d_action_craft_glittering_scales" value = 0
			}
			set_variable = {
				which = "d_action_craft_dragonhelm" value = 0
			}
			set_variable = {
				which = "d_action_craft_tricksters_helm" value = 0
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = "0"
			}
			set_variable = {
				which = "action_picked" value = "1"
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_helm_of_discord" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_glittering_scales" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_dragonhelm" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_tricksters_helm" which = "action_nr"
				}
			}
		}
		long_character_event = {
			id = z_item_crafting_menu.62
		}
	}
}

long_character_event = {
	id = z_item_crafting_menu.62
	title = "Arcane Spell Casting"
	desc = "Arcane Magic, perhaps the most profound force in existance. This kind of power is one that rapidly exceeds the imagination and capability of many, unleashing unto the world forces at the limit's of comprehension."
	picture = "GFX_evt_mage_choose_lore"
	is_triggered_only = yes

	trigger = {
		event_target:item_crafter = {
			is_alive = yes
		}
	}
	# next action

	option = {
		name = "NEXT_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" which = "action_nr"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" value = 1
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.62
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" which = "action_nr"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = 1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.62
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 1
		}
	}
	# previous action

	option = {
		name = "PREVIOUS_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" value = "1"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = -1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.62
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" value = "1"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" which = "action_nr"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.62
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "Craft Helm of Discord"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic ring, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_helm_of_discord"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = helm_of_discord
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Glittering Scales"
		custom_tooltip = {
			text = "Engage in the crafting of a potent Magic Staff, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_glittering_scales"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = glittering_scales
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Dragonhelm"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic amulet, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_dragonhelm"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = dragonhelm
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Tricksters Helm"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic spell book, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_tricksters_helm"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = tricksters_helm
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Retun to Crafting Menu"
		character_event = {
			id = z_item_crafting_menu.0
		}
		ai_chance = {
			factor = 1
		}
	}
}

# Item Crafting Banner
character_event = {
	id = z_item_crafting_menu.71
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = 0
			}
			set_variable = {
				which = "d_action_cancel" value = 0
			}
			set_variable = {
				which = "action_picked" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_ring" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_amulet" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_staff" value = 0
			}
			set_variable = {
				which = "d_action_craft_magic_spellbook" value = 0
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "action_nr" value = "0"
			}
			set_variable = {
				which = "action_picked" value = "1"
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_ring" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_spellbook" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_staff" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					in_command = no
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_nr" value = 1
				}
				change_variable = {
					which = "d_action_craft_magic_amulet" which = "action_nr"
				}
			}
		}
		long_character_event = {
			id = z_item_crafting_menu.72
		}
	}
}

long_character_event = {
	id = z_item_crafting_menu.72
	title = "Arcane Spell Casting"
	desc = "Arcane Magic, perhaps the most profound force in existance. This kind of power is one that rapidly exceeds the imagination and capability of many, unleashing unto the world forces at the limit's of comprehension."
	picture = "GFX_evt_mage_choose_lore"
	is_triggered_only = yes

	trigger = {
		event_target:item_crafter = {
			is_alive = yes
		}
	}
	# next action

	option = {
		name = "NEXT_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" which = "action_nr"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" value = 1
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.72
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" which = "action_nr"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = 1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.72
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 1
		}
	}
	# previous action

	option = {
		name = "PREVIOUS_ACTION"
		if = {
			limit = {
				event_target:item_crafter = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" value = "1"
						}
					}
				}
			}
			event_target:item_crafter = {
				change_variable = {
					which = "action_picked" value = -1
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.72
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:item_crafter = {
					is_variable_equal = {
						which = "action_picked" value = "1"
					}
				}
			}
			event_target:item_crafter = {
				set_variable = {
					which = "action_picked" which = "action_nr"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_item_crafting_menu.72
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "Craft Magic Ring"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic ring, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_ring"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_ring_3
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Magic Staff"
		custom_tooltip = {
			text = "Engage in the crafting of a potent Magic Staff, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_staff"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_staff_3
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Magic Amulet"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic amulet, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_amulet"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_amulet_3
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Craft Magic Spell Book"
		custom_tooltip = {
			text = "Engage in the crafting of a potent magic spell book, this item will boost your success at casting spells."
		}
		trigger = {
			event_target:item_crafter = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_craft_magic_spellbook"
				}
			}
		}
		event_target:item_crafter = {
			set_variable = {
				which = "miscast" value = 1
			}
			set_variable = {
				which = "dispel" value = 1
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:item_crafter = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:item_crafter = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:item_crafter = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = z_spell_menu.99998
			}
			random_list = {
				1 = {
					event_target:item_recipient = {
						add_artifact = mages_spellbook_3
					}
				}
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "Retun to Crafting Menu"
		character_event = {
			id = z_item_crafting_menu.0
		}
		ai_chance = {
			factor = 1
		}
	}
}

# Item Crafting
