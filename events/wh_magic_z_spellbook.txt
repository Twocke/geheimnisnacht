namespace = z_spell_menu

character_event = {
	id = z_spell_menu.1
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		log = "work event id = z_spell_menu.1 for [Root.GetBestName]"
		event_target:magic_caster = {
			set_variable = {
				which = "warpfire"
				value = "0"
			}
			set_variable = {
				which = "fieryconv"
				value = "0"
			}
			set_variable = {
				which = "searing_metal"
				value = "0"
			}
			set_variable = {
				which = "tanglingvine"
				value = "0"
			}
			set_variable = {
				which = "healingbloom"
				value = "0"
			}
			set_variable = {
				which = "burstingvine"
				value = "0"
			}
			set_variable = {
				which = "icestorm"
				value = "0"
			}
			set_variable = {
				which = "fierystorm"
				value = "0"
			}
			set_variable = {
				which = "deathproc"
				value = "0"
			}
			set_variable = {
				which = "bladestorm"
				value = "0"
			}
			clr_character_flag = channel
			magic_xp_counter = yes
			magic_points_setup = yes
			magic_spells_known = yes
		}
		character_event = {
			id = z_spell_menu.0
		}
	}
}

character_event = {
	id = z_spell_menu.0
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		log = "work event id = z_spell_menu.0 for [Root.GetBestName]"
		event_target:magic_caster = {
			magic_spells_known = yes
			set_variable = {
				which = "action_nr"
				value = "0"
			}
			set_variable = {
				which = "d_action_channel"
				value = "0"
			}
			set_variable = {
				which = "d_action_cancel"
				value = "0"
			}
			set_variable = {
				which = "action_picked"
				value = "0"
			}
			if = {
				limit = {
					event_target:magic_caster = {
						trait = lore_high_magic
					}
				}
				set_variable = {
					which = "d_action_high_magic_soul_quench"
					value = "0"
				}
				set_variable = {
					which = "d_action_high_magic_drain"
					value = "0"
				}
				set_variable = {
					which = "d_action_high_magic_apotheoisis"
					value = "0"
				}
				set_variable = {
					which = "d_action_high_magic_firey_convocation"
					value = "0"
				}
				set_variable = {
					which = "d_action_high_magic_healing_light_of_qyesh"
					value = "0"
				}
				set_variable = {
					which = "d_action_high_magic_empowering_martial_mastery"
					value = "0"
				}
				set_variable = {
					which = "d_action_high_magic_shining_light_of_hope"
					value = "0"
				}
				set_variable = {
					which = "d_action_high_magic_sacred_light_of_fertility"
					value = "0"
				}
				set_variable = {
					which = "d_action_high_magic_ward_of_protection"
					value = "0"
				}
				set_variable = {
					which = "d_action_high_magic_ward_of_armies_deliverance"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						z_lore_of_heavens_caster = yes
					}
				}
				set_variable = {
					which = "d_action_heavens_lore_chain_lightning"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_comet"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_urannons_thunderbolt"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_foresight"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_calm_the_storm"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_binding_of_fate_blessing"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_Enlightenment_of_the_heavens"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_divination"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_curse_of_the_heavens"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_fury_of_the_storm"
					value = "0"
				}
				set_variable = {
					which = "d_action_heavens_lore_binding_of_fate_curse"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						z_lore_of_beasts_caster = yes
					}
				}
				set_variable = {
					which = "d_action_beasts_lore_wrath_of_the_wild"
					value = "0"
				}
				set_variable = {
					which = "d_action_beasts_lore_amber_spear"
					value = "0"
				}
				set_variable = {
					which = "d_action_beasts_lore_beasts_gone_wild"
					value = "0"
				}
				set_variable = {
					which = "d_action_beasts_lore_beasts_of_the_wild"
					value = "0"
				}
				set_variable = {
					which = "d_action_beasts_lore_horrendous_transmutation"
					value = "0"
				}
				set_variable = {
					which = "d_action_beasts_lore_army_of_the_woods"
					value = "0"
				}
				set_variable = {
					which = "d_action_beasts_lore_taming_of_the_wilds"
					value = "0"
				}
				set_variable = {
					which = "d_action_beasts_lore_unending_horde_of_nature"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						z_lore_of_death_caster = yes
					}
				}
				set_variable = {
					which = "d_action_death_lore_death_bolt"
					value = "0"
				}
				set_variable = {
					which = "d_action_death_lore_black_sphere"
					value = "0"
				}
				set_variable = {
					which = "d_action_death_lore_ward_of_death"
					value = "0"
				}
				set_variable = {
					which = "d_action_death_lore_deaths_majesty"
					value = "0"
				}
				set_variable = {
					which = "d_action_death_lore_curse_inevitability"
					value = "0"
				}
				set_variable = {
					which = "d_action_death_lore_eternal_rest_of_the_unliving"
					value = "0"
				}
				set_variable = {
					which = "d_action_death_lore_the_shadow_of_death"
					value = "0"
				}
				set_variable = {
					which = "d_action_death_lore_deaths_rest"
					value = "0"
				}
				set_variable = {
					which = "d_action_death_lore_soul_destruction"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						z_lore_of_fire_caster = yes
					}
				}
				set_variable = {
					which = "d_action_fire_lore_fireball"
					value = "0"
				}
				set_variable = {
					which = "d_action_fire_lore_firestorm"
					value = "0"
				}
				set_variable = {
					which = "d_action_fire_lore_blast_of_flame"
					value = "0"
				}
				set_variable = {
					which = "d_action_fire_lore_burning_blade"
					value = "0"
				}
				set_variable = {
					which = "d_action_fire_lore_blazing_blade"
					value = "0"
				}
				set_variable = {
					which = "d_action_fire_lore_fires_hope"
					value = "0"
				}
				set_variable = {
					which = "d_action_fire_lore_wild_fire"
					value = "0"
				}
				set_variable = {
					which = "d_action_fire_lore_blazing_heat"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						z_lore_of_life_caster = yes
					}
				}
				set_variable = {
					which = "d_action_life_lore_Overgrowth"
					value = "0"
				}
				set_variable = {
					which = "d_action_life_lore_resurrection"
					value = "0"
				}
				set_variable = {
					which = "d_action_life_lore_grasping_vine"
					value = "0"
				}
				set_variable = {
					which = "d_action_life_lore_Life_blossom"
					value = "0"
				}
				set_variable = {
					which = "d_action_life_lore_growth_of_the_forrest"
					value = "0"
				}
				set_variable = {
					which = "d_action_life_lore_healing_touch"
					value = "0"
				}
				set_variable = {
					which = "d_action_life_lore_crushing_vine"
					value = "0"
				}
				set_variable = {
					which = "d_action_life_lore_purification_of_darkness"
					value = "0"
				}
				set_variable = {
					which = "d_action_life_lore_restoration_of_life"
					value = "0"
				}
				set_variable = {
					which = "d_action_life_lore_natures_enrichment"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						z_lore_of_light_caster = yes
					}
				}
				set_variable = {
					which = "d_action_light_lore_holy_fire"
					value = "0"
				}
				set_variable = {
					which = "d_action_light_lore_speed_of_light"
					value = "0"
				}
				set_variable = {
					which = "d_action_light_lore_Wall_of_light"
					value = "0"
				}
				set_variable = {
					which = "d_action_light_lore_Light_of_the_Heavens"
					value = "0"
				}
				set_variable = {
					which = "d_action_light_lore_spiritual_renewal"
					value = "0"
				}
				set_variable = {
					which = "d_action_light_lore_restoration_of_the_body"
					value = "0"
				}
				set_variable = {
					which = "d_action_light_lore_holy_hexagrammic_wards"
					value = "0"
				}
				set_variable = {
					which = "d_action_light_lore_shield_of_radiant_light"
					value = "0"
				}
				set_variable = {
					which = "d_action_light_lore_sacred_rejuvenation"
					value = "0"
				}
				set_variable = {
					which = "d_action_light_lore_exorcism_of_darkness"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						z_lore_of_shadows_caster = yes
					}
				}
				set_variable = {
					which = "d_action_shadows_lore_shadow_bolt"
					value = "0"
				}
				set_variable = {
					which = "d_action_shadows_lore_mortal_terror"
					value = "0"
				}
				set_variable = {
					which = "d_action_shadows_lore_wave_of_darkness"
					value = "0"
				}
				set_variable = {
					which = "d_action_shadows_lore_steed_of_shadows"
					value = "0"
				}
				set_variable = {
					which = "d_action_shadows_lore_hateful_whispers"
					value = "0"
				}
				set_variable = {
					which = "d_action_shadows_lore_manipulation_of_the_mind"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						z_lore_of_metal_caster = yes
					}
				}
				set_variable = {
					which = "d_action_metal_lore_flesh_to_gold"
					value = "0"
				}
				set_variable = {
					which = "d_action_metal_lore_weight_of_iron"
					value = "0"
				}
				set_variable = {
					which = "d_action_metal_lore_Curse_of_Rust"
					value = "0"
				}
				set_variable = {
					which = "d_action_metal_lore_blessings_of_steel"
					value = "0"
				}
				set_variable = {
					which = "d_action_metal_lore_soul_of_iron"
					value = "0"
				}
				set_variable = {
					which = "d_action_metal_lore_alchemical_reactions"
					value = "0"
				}
				set_variable = {
					which = "d_action_metal_lore_untrammelled_riches"
					value = "0"
				}
				set_variable = {
					which = "d_action_metal_lore_conjured_automation"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						trait = lore_dark_magic
					}
				}
				set_variable = {
					which = "d_action_dark_magic_doombolt"
					value = "0"
				}
				set_variable = {
					which = "d_action_dark_magic_bladewind"
					value = "0"
				}
				set_variable = {
					which = "d_action_dark_magic_dark_fury"
					value = "0"
				}
				set_variable = {
					which = "d_action_dark_magic_black_horror"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						trait = lore_necromancy
					}
				}
				set_variable = {
					which = "d_action_lore_necromancy_imbide_life"
					value = "0"
				}
				set_variable = {
					which = "d_action_lore_necromancy_unholy_life"
					value = "0"
				}
				set_variable = {
					which = "d_action_lore_necromancy_unholy_resolve"
					value = "0"
				}
				set_variable = {
					which = "d_action_lore_necromancy_damnation_of_the_dead"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						trait = lore_vermin
					}
				}
				set_variable = {
					which = "d_action_ruin_lore_warp_lightning"
					value = "0"
				}
				set_variable = {
					which = "d_action_ruin_lore_cracks_of_doom"
					value = "0"
				}
				set_variable = {
					which = "d_action_ruin_lore_Breath_of_Pestilence"
					value = "0"
				}
				set_variable = {
					which = "d_action_ruin_lore_Vermintide"
					value = "0"
				}
				set_variable = {
					which = "d_action_ruin_lore_13_spell"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						trait = lore_ice
					}
				}
				set_variable = {
					which = "d_action_lore_ice_1"
					value = "0"
				}
				set_variable = {
					which = "d_action_lore_ice_2"
					value = "0"
				}
				set_variable = {
					which = "d_action_lore_ice_3"
					value = "0"
				}
				set_variable = {
					which = "d_action_lore_ice_4"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						trait = lore_tzeentch
					}
				}
				set_variable = {
					which = "d_action_tzeentch_lore_screamers"
					value = "0"
				}
				set_variable = {
					which = "d_action_tzeentch_lore_twisting_paths"
					value = "0"
				}
				set_variable = {
					which = "d_action_tzeentch_lore_bolt_of_change"
					value = "0"
				}
				set_variable = {
					which = "d_action_tzeentch_lore_flames_of_mutation"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						trait = lore_slaanesh
					}
				}
				set_variable = {
					which = "d_action_slaanesh_lore_daemonettes"
					value = "0"
				}
				set_variable = {
					which = "d_action_slaanesh_lore_choir"
					value = "0"
				}
				set_variable = {
					which = "d_action_slaanesh_lore_Unholy_Screaming"
					value = "0"
				}
				set_variable = {
					which = "d_action_slaanesh_lore_wailing_madness"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						trait = lore_nurgle
					}
				}
				set_variable = {
					which = "d_action_nurgle_lore_embrace"
					value = "0"
				}
				set_variable = {
					which = "d_action_nurgle_lore_Plague_bearers"
					value = "0"
				}
				set_variable = {
					which = "d_action_nurgle_lore_bolt_of_rot"
					value = "0"
				}
				set_variable = {
					which = "d_action_nurgle_lore_Maw_of_disease"
					value = "0"
				}
			}
			if = {
				limit = {
					event_target:magic_caster = {
						trait = lore_waaagh
					}
				}
				set_variable = {
					which = "d_action_lore_orc_sneaky_stabbin"
					value = "0"
				}
				set_variable = {
					which = "d_action_lore_orc_eare_we_go"
					value = "0"
				}
				set_variable = {
					which = "d_action_lore_orc_morkll_fix_it"
					value = "0"
				}
				set_variable = {
					which = "d_action_lore_orc_eare_we_go"
					value = "0"
				}
			}
		}
		event_target:magic_caster = {
			set_variable = {
				which = "action_nr"
				value = "0"
			}
			set_variable = {
				which = "action_picked"
				value = "1"
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_valid_channeller = yes
					NOT = {
						has_character_flag = channel
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_channel" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_high_magic
					in_command = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_drain" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_high_magic
					in_command = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_soul_quench" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_high_magic
					in_command = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_apotheoisis" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					in_command = yes
					trait = lore_high_magic
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_firey_convocation" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_high_magic
					in_command = no
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_healing_light_of_qyesh" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_high_magic
					in_command = no
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_empowering_martial_mastery" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_high_magic
					in_command = no
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_shining_light_of_hope" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_high_magic
					in_command = no
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_sacred_light_of_fertility" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_high_magic
					in_command = no
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "5"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_ward_of_protection" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_high_magic
					in_command = no
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "6"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_high_magic_ward_of_armies_deliverance" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_dark_magic
					in_command = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_dark_magic_doombolt" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_dark_magic
					in_command = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_dark_magic_dark_fury" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_dark_magic
					in_command = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_dark_magic_bladewind" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					in_command = yes
					trait = lore_dark_magic
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_dark_magic_black_horror" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_foresight" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_urannons_thunderbolt" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_chain_lightning" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_comet" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_divination" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_fury_of_the_storm" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_calm_the_storm" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_Enlightenment_of_the_heavens" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_curse_of_the_heavens" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "6"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_binding_of_fate_blessing" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_heavens_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "6"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_heavens_lore_binding_of_fate_curse" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_beasts_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_beasts_lore_wrath_of_the_wild" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_beasts_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_beasts_lore_beasts_gone_wild" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_beasts_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_beasts_lore_beasts_of_the_wild" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_beasts_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_beasts_lore_amber_spear" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_beasts_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = no
				}
				event_target:spelltarget = {
					NOR = {
						trait = monstrous
						trait = creature_beastman
						trait = creature_pig
						trait = creature_toad
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_beasts_lore_horrendous_transmutation" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_beasts_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_beasts_lore_army_of_the_woods" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_beasts_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = no
				}
				event_target:spelltarget = {
					NOR = {
						has_artifact = stegadon_mount
						has_artifact = bastiladon_mount
						has_artifact = carnosaur_mount
						has_artifact = ripperdactyl_mount
						has_artifact = pegasus_mount
						has_artifact = nightmare_mount
						has_artifact = red_dragon_mount
						has_artifact = gryphon_mount
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_beasts_lore_taming_of_the_wilds" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_beasts_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_beasts_lore_unending_horde_of_nature" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_metal_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_metal_lore_flesh_to_gold" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_metal_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_metal_lore_weight_of_iron" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_metal_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_metal_lore_Curse_of_Rust" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_metal_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_metal_lore_blessings_of_steel" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_life_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_life_lore_grasping_vine" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_life_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_life_lore_Life_blossom" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_life_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_life_lore_Overgrowth" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_life_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_life_lore_resurrection" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_fire_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_fire_lore_fireball" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_fire_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_fire_lore_burning_blade" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_fire_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_fire_lore_blast_of_flame" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_fire_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_fire_lore_firestorm" which = "action_nr"
				}
			}
		}
		# Fire Lore Non Combat Magic
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_fire_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_fire_lore_blazing_blade" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_fire_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_fire_lore_fires_hope" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_fire_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_fire_lore_wild_fire" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_fire_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_fire_lore_blazing_heat" which = "action_nr"
				}
			}
		}
		# Shadow lore Battle Magic
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_shadows_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_shadows_lore_shadow_bolt" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_shadows_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_shadows_lore_steed_of_shadows" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_shadows_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_shadows_lore_mortal_terror" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_shadows_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_shadows_lore_wave_of_darkness" which = "action_nr"
				}
			}
		}
		# shadow lore non combat Magic
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_shadows_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_shadows_lore_manipulation_of_the_mind" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_shadows_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = no
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_shadows_lore_hateful_whispers" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_death_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_death_lore_death_bolt" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_death_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_death_lore_ward_of_death" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_death_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_death_lore_deaths_majesty" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_death_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_death_lore_black_sphere" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_light_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_light_lore_holy_fire" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_light_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_light_lore_speed_of_light" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_light_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_light_lore_Wall_of_light" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					z_lore_of_light_caster = yes
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_light_lore_Light_of_the_Heavens" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_waaagh
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_lore_orc_sneaky_stabbin" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_waaagh
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_lore_orc_eare_we_go" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_waaagh
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_lore_orc_morkll_fix_it" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_waaagh
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_lore_orc_foot_of_gork" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_necromancy
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_lore_necromancy_imbide_life" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_necromancy
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_lore_necromancy_unholy_life" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_necromancy
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_lore_necromancy_unholy_resolve" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_necromancy
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_lore_necromancy_damnation_of_the_dead" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_nurgle
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_nurgle_lore_bolt_of_rot" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_nurgle
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_nurgle_lore_embrace" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_nurgle
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_nurgle_lore_Plague_bearers" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_nurgle
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_nurgle_lore_Maw_of_disease" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_slaanesh
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_slaanesh_lore_Unholy_Screaming" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_slaanesh
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_slaanesh_lore_wailing_madness" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_slaanesh
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_slaanesh_lore_daemonettes" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_slaanesh
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_slaanesh_lore_choir" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_tzeentch
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_tzeentch_lore_bolt_of_change" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_tzeentch
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_tzeentch_lore_flames_of_mutation" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_tzeentch
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_tzeentch_lore_screamers" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_tzeentch
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_tzeentch_lore_twisting_paths" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_ice
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_lore_ice_1" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_ice
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "lore_ice" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_ice
					check_variable = {
						which = "spellknownlvl"
						value = "3"
					}
					check_variable = {
						which = "spell_power"
						value = "3"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "lore_ice" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = lore_ice
					check_variable = {
						which = "spellknownlvl"
						value = "4"
					}
					check_variable = {
						which = "spell_power"
						value = "4"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "lore_ice" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					or = {
						trait = lore_vermin
						trait = warlock_engineer
					}
					check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_ruin_lore_warp_lightning" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					or = {
						trait = lore_vermin
						trait = warlock_engineer
					} check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_ruin_lore_cracks_of_doom" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					or = {
						trait = lore_vermin
						trait = warlock_engineer
					} check_variable = {
						which = "spellknownlvl"
						value = "1"
					}
					check_variable = {
						which = "spell_power"
						value = "1"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_ruin_lore_Breath_of_Pestilence" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					or = {
						trait = lore_vermin
						trait = warlock_engineer
					}
					check_variable = {
						which = "spellknownlvl"
						value = "2"
					}
					check_variable = {
						which = "spell_power"
						value = "2"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_ruin_lore_Vermintide" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					trait = grey_seer
					check_variable = {
						which = "spellknownlvl"
						value = "6"
					}
					check_variable = {
						which = "spell_power"
						value = "6"
					}
					in_command = yes
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_ruin_lore_13_spell" which = "action_nr"
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_nr"
					value = "1"
				}
				change_variable = {
					which = "d_action_cancel" which = "action_nr"
				}
			}
		}
		long_character_event = {
			id = z_spell_menu.2
		}
	}
}
long_character_event = {
	id = z_spell_menu.2
	title = z_spell_menu.2
	desc = "z_spell_menu.2_desc"
	picture = "GFX_evt_mage_choose_lore"
	is_triggered_only = yes

	trigger = {
		event_target:magic_caster = {
			is_alive = yes
		}
	}

	# next action
	immediate = {
		log = "work event id = z_spell_menu.2 for [Root.GetBestName]"
	}

	option = {
		name = "NEXT_ACTION"
		if = {
			limit = {
				event_target:magic_caster = {
					NOT = {
						is_variable_equal = {
							which = "action_picked" which = "action_nr"
						}
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_picked"
					value = "1"
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_spell_menu.2
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:magic_caster = {
					is_variable_equal = {
						which = "action_picked" which = "action_nr"
					}
				}
			}
			event_target:magic_caster = {
				set_variable = {
					which = "action_picked"
					value = "1"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_spell_menu.2
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 1
		}
	}

	# previous action
	option = {
		name = "PREVIOUS_ACTION"
		if = {
			limit = {
				event_target:magic_caster = {
					NOT = {
						is_variable_equal = {
							which = "action_picked"
							value = "1"
						}
					}
				}
			}
			event_target:magic_caster = {
				change_variable = {
					which = "action_picked"
					value = "-1"
				}
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_spell_menu.2
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:magic_caster = {
					is_variable_equal = {
						which = "action_picked"
						value = "1"
					}
				}
			}
			event_target:magic_caster = {
				set_variable = {
					which = "action_picked" which = "action_nr"
				} # circular menu
			}
			hidden_tooltip = {
				repeat_event = {
					id = z_spell_menu.2
				}
			}
			break = yes
		}
		ai_chance = {
			factor = 0
		}
	}

	# Channelling Action
	option = {
		name = "Channel Magic Power"
		custom_tooltip = {
			text = "By investing time, you generate a random amount of magic points."
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_channel"
				}
				NOT = {
					has_character_flag = channel
				}
			}
		}
		event_target:magic_caster = {
			channeling = yes
			set_character_flag = channel
		}
		hidden_tooltip = {
			repeat_event = {
				id = z_spell_menu.0 days = 15
			}
		}
		ai_chance = {
			factor = 1
		}
	}

	# High Magic Combat Magics
	option = {
		name = "high_magic_lore.2a"
		custom_tooltip = {
			text = "high_magic_lore.2a_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_drain"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = "-1"
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "high_magic_lore.2b"
		custom_tooltip = {
			text = "high_magic_lore.2b_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_soul_quench"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "high_magic_lore.2c"
		custom_tooltip = {
			text = "high_magic_lore.2c_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_apotheoisis"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "2"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "high_magic_lore.2d"
		custom_tooltip = {
			text = "high_magic_lore.2d_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_firey_convocation"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "4"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	# High Magic Non Combat Magics
	option = {
		name = "high_magic_lore_non_battle.2a"
		custom_tooltip = {
			text = "high_magic_lore_non_battle.2a_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_healing_light_of_qyesh"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "2"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore_non_battle.101
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				event_target:spelltarget = {
					NOT = {
						OR = {
							trait = wounded
							trait = maimed
							trait = incapable
							trait = troubled_pregnancy
							trait = hard_pregnancy
							trait = disfigured
							trait = possessed
						}
						is_undead_trigger = no
					}
				}
			}
			modifier = {
				factor = 0.5
				nor = {
					event_target:spelllord = {
						trait = kind
					}
					event_target:spelllord = {
						dynasty = event_target:spelltarget
					}
				}
			}
			modifier = {
				factor = 2
				event_target:spelltarget = {
					liege = {
						character = event_target:spelllord
					}
				}
			}
		}
	}

	option = {
		name = "high_magic_lore_non_battle.2b"
		custom_tooltip = {
			text = "high_magic_lore_non_battle.2b_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_empowering_martial_mastery"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "2"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore_non_battle.201
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "high_magic_lore_non_battle.2c"
		custom_tooltip = {
			text = "high_magic_lore_non_battle.2c_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_shining_light_of_hope"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "2"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore_non_battle.301
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "high_magic_lore_non_battle.2d"
		custom_tooltip = {
			text = "high_magic_lore_non_battle.2d_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_sacred_light_of_fertility"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "2"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore_non_battle.401
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "high_magic_lore_non_battle.2e"
		custom_tooltip = {
			text = "high_magic_lore_non_battle.2e_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_ward_of_protection"
				}
				check_variable = {
					which = "spell_power"
					value = "5"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -5
			}
			set_variable = {
				which = "miscast"
				value = "2"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore_non_battle.501
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "high_magic_lore_non_battle.2f"
		custom_tooltip = {
			text = "high_magic_lore_non_battle.2f_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_high_magic_ward_of_armies_deliverance"
				}
				check_variable = {
					which = "spell_power"
					value = "6"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = "-6"
			}
			set_variable = {
				which = "miscast"
				value = "2"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = high_magic_lore_non_battle.601
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	# Heavens Lore Combat Magics
	option = {
		name = "heavens_lore.2a"
		custom_tooltip = {
			text = "heavens_lore.2a_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_foresight"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = "-1"
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "heavens_lore.2b"
		custom_tooltip = {
			text = "heavens_lore.2b_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_urannons_thunderbolt"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			if = {
				limit = {
					has_character_modifier = magic_lore_heavens_foresight
				}
				set_variable = {
					which = "miscast"
					value = "3"
				}
				set_variable = {
					which = "dispel"
					value = "2"
				}
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "heavens_lore.2c"
		custom_tooltip = {
			text = "heavens_lore.2c_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_chain_lightning"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			if = {
				limit = {
					has_character_modifier = magic_lore_heavens_foresight
				}
				set_variable = {
					which = "miscast"
					value = "5"
				}
				set_variable = {
					which = "dispel"
					value = "3"
				}
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "heavens_lore.2d"
		custom_tooltip = {
			text = "heavens_lore.2d_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_comet"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "6"
			}
			if = {
				limit = {
					has_character_modifier = magic_lore_heavens_foresight
				}
				set_variable = {
					which = "miscast"
					value = "6"
				}
				set_variable = {
					which = "dispel"
					value = "4"
				}
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	# Heavens Lore Non Combat Magic
	option = {
		name = "heavens_lore_non_battle.2a"
		custom_tooltip = {
			text = "heavens_lore_non_battle.2a_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_divination"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore_non_battle.101
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "heavens_lore_non_battle.2b"
		custom_tooltip = {
			text = "heavens_lore_non_battle.2b_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_fury_of_the_storm"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore_non_battle.201
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "heavens_lore_non_battle.2c"
		custom_tooltip = {
			text = "heavens_lore_non_battle.2c_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_calm_the_storm"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore_non_battle.301
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "heavens_lore_non_battle.2d"
		custom_tooltip = {
			text = "heavens_lore_non_battle.2d_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_Enlightenment_of_the_heavens"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore_non_battle.401
			}
		}
		z_spell_process = yes ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "heavens_lore_non_battle.2e"
		custom_tooltip = {
			text = "heavens_lore_non_battle.2e_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_curse_of_the_heavens"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore_non_battle.501
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "heavens_lore_non_battle.2f"
		custom_tooltip = {
			text = "heavens_lore_non_battle.2f_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_binding_of_fate_blessing"
				}
				check_variable = {
					which = "spell_power"
					value = "6"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -6
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore_non_battle.601
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "heavens_lore_non_battle.2g"
		custom_tooltip = {
			text = "heavens_lore_non_battle.2g_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_heavens_lore_binding_of_fate_curse"
				}
				check_variable = {
					which = "spell_power"
					value = "6"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -6
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = heavens_lore_non_battle.701
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
		}
	}

	# Beast Lore Combat Magic
	option = {
		name = "beasts_lore.2a"
		custom_tooltip = {
			text = "beasts_lore.2a_desc"
		}
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_beasts_lore_wrath_of_the_wild"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = beasts_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "beasts_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_beasts_lore_beasts_gone_wild"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = beasts_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "beasts_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_beasts_lore_beasts_of_the_wild"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = 7
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = beasts_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "beasts_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_beasts_lore_amber_spear"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = beasts_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 1
		}
	}

	# Beast Lore Non Combat Magic
	option = {
		name = "beasts_lore_non_battle.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_beasts_lore_horrendous_transmutation"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = beasts_lore_non_battle.101
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				event_target:spelllord = {
					opinion = {
						who = event_target:spelltarget
						value = "5"
					}
				}
			}
		}
	}

	option = {
		name = "beasts_lore_non_battle.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_beasts_lore_army_of_the_woods"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = beasts_lore_non_battle.201
			}
		}
		z_spell_process = yes ai_chance = {
			factor = 1
		}
	}

	option = {
		name = "beasts_lore_non_battle.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_beasts_lore_taming_of_the_wilds"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = beasts_lore_non_battle.301
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "beasts_lore_non_battle.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_beasts_lore_unending_horde_of_nature"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = beasts_lore_non_battle.401
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	# Fire Lore Combat Magic
	option = {
		name = "fire_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_fire_lore_fireball"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = fire_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "fire_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_fire_lore_burning_blade"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = fire_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "fire_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_fire_lore_blast_of_flame"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = 7
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = fire_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "fire_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_fire_lore_firestorm"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = fire_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	# Fire Lore Non Combat
	option = {
		name = "fire_lore_non_battle.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_fire_lore_blazing_blade"
				}
				check_variable = {
					which = "spell_power"
					value = -1
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = "1"
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = fire_lore_non_battle.101
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "fire_lore_non_battle.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_fire_lore_fires_hope"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = fire_lore_non_battle.201
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "fire_lore_non_battle.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_fire_lore_wild_fire"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = fire_lore_non_battle.301
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "fire_lore_non_battle.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_fire_lore_blazing_heat"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = fire_lore_non_battle.401
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	# Death lore Combat
	option = {
		name = "death_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_death_lore_death_bolt"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = death_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "death_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_death_lore_ward_of_death"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = death_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "death_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_death_lore_deaths_majesty"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = death_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "death_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_death_lore_black_sphere"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = death_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	# Shadows Lore Combat Magics
	option = {
		name = "shadows_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_shadows_lore_shadow_bolt"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = shadows_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "shadows_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_shadows_lore_steed_of_shadows"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = shadows_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "shadows_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_shadows_lore_mortal_terror"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = 7
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = shadows_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "shadows_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_shadows_lore_wave_of_darkness"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = shadows_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	# Shadows Lore Non Combat Magics
	option = {
		name = "shadows_lore_non_battle.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_shadows_lore_manipulation_of_the_mind"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
				not = {
					character = event_target:spelltarget
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = shadows_lore_non_battle.101
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "shadows_lore_non_battle.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_shadows_lore_hateful_whispers"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
				not = {
					character = event_target:spelltarget
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = shadows_lore_non_battle.201
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	# Metal Lore Combat Magics
	option = {
		name = "metal_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_metal_lore_flesh_to_gold"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = metal_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "metal_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_metal_lore_weight_of_iron"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = metal_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "metal_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_metal_lore_Curse_of_Rust"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = 7
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = metal_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "metal_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_metal_lore_blessings_of_steel"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = metal_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "metal_lore_non_battle.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_metal_lore_soul_of_iron"
				}
				check_variable = {
					which = "spell_power"
					value = -1
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = "1"
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = metal_lore_non_battle.101
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "metal_lore_non_battle.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_metal_lore_alchemical_reactions"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = metal_lore_non_battle.201
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "metal_lore_non_battle.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_metal_lore_untrammelled_riches"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = metal_lore_non_battle.301
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "metal_lore_non_battle.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_metal_lore_conjured_automation"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "3"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = metal_lore_non_battle.401
			}
		}
		z_spell_process = yes
		ai_chance = {
			factor = 0
		}
	}

	# Mfire Lore combat
	option = {
		name = "light_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_light_lore_holy_fire"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = light_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "light_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_light_lore_speed_of_light"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = light_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "light_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_light_lore_Wall_of_light"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = 7
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = light_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "light_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_light_lore_Light_of_the_Heavens"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = light_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "life_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_life_lore_grasping_vine"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = life_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "life_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_life_lore_Life_blossom"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = life_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "life_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_life_lore_Overgrowth"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = 7
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = life_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "life_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_life_lore_resurrection"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = life_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "dark_magic_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_dark_magic_doombolt"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = dark_magic_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "dark_magic_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_dark_magic_dark_fury"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = 9
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = dark_magic_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "dark_magic_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_dark_magic_bladewind"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = dark_magic_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "dark_magic_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_dark_magic_black_horror"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = dark_magic_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "ruin_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_ruin_lore_warp_lightning"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
				not = {
					trait = plaguelord
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = ruin_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "ruin_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_ruin_lore_cracks_of_doom"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
				not = {
					trait = plaguelord
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = 7
			}
			set_variable = {
				which = "dispel"
				value = "3"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = ruin_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "ruin_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_ruin_lore_Breath_of_Pestilence"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
				not = {
					trait = warlock_engineer
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "5"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = ruin_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "ruin_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_ruin_lore_Vermintide"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
				not = {
					trait = warlock_engineer
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = 7
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = ruin_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "ruin_lore.1d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_ruin_lore_13_spell"
				}
				check_variable = {
					which = "spell_power"
					value = "6"
				}
				trait = grey_seer
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -6
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "1"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = ruin_lore.501
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "necromancy_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_necromancy_imbide_life"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = 8
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = necromancy_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "necromancy_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_necromancy_unholy_life"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "9"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = necromancy_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "necromancy_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_necromancy_unholy_resolve"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = necromancy_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "necromancy_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_necromancy_damnation_of_the_dead"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "5"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = necromancy_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "orc_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_orc_eare_we_go"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = orc_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "orc_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_orc_sneaky_stabbin"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = orc_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "orc_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_orc_morkll_fix_it"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = orc_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "orc_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_orc_foot_of_gork"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "2"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = orc_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "ice_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_ice_1"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "7"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = ice_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "ice_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_ice_2"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "8"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = ice_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "ice_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_ice_3"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "9"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = ice_lore.301
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "ice_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_lore_ice_4"
				}
				check_variable = {
					which = "spell_power"
					value = "4"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -4
			}
			set_variable = {
				which = "miscast"
				value = "1"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = ice_lore.401
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "nurgle_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_nurgle_lore_bolt_of_rot"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = nurgle_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "nurgle_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_nurgle_lore_embrace"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = nurgle_lore.201
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "nurgle_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_nurgle_lore_Plague_bearers"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = nurgle_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "nurgle_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_nurgle_lore_Maw_of_disease"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = nurgle_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "slaanesh_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_slaanesh_lore_Unholy_Screaming"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = slaanesh_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "slaanesh_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_slaanesh_lore_wailing_madness"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = slaanesh_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "slaanesh_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_slaanesh_lore_daemonettes"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = slaanesh_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "slaanesh_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_slaanesh_lore_choir"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = slaanesh_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "tzeentch_lore.2a"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_tzeentch_lore_bolt_of_change"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = tzeentch_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "tzeentch_lore.2b"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_tzeentch_lore_flames_of_mutation"
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -1
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = tzeentch_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "tzeentch_lore.2c"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_tzeentch_lore_screamers"
				}
				check_variable = {
					which = "spell_power"
					value = "2"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -2
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = tzeentch_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "tzeentch_lore.2d"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_tzeentch_lore_twisting_paths"
				}
				check_variable = {
					which = "spell_power"
					value = "3"
				}
			}
		}
		event_target:magic_caster = {
			change_variable = {
				which = "spell_power"
				value = -3
			}
			set_variable = {
				which = "miscast"
				value = "6"
			}
			set_variable = {
				which = "dispel"
				value = "4"
			}
			z_miscast_case = yes
			dispel_setup_effect = yes
			if = {
				limit = {
					event_target:magic_caster = {
						has_character_flag = has_dispel
					}
				}
				z_dispell_case = yes
				event_target:magic_caster = {
					clr_character_flag = has_dispel
				}
			}
		}
		if = {
			limit = {
				event_target:magic_caster = {
					NOR = {
						has_character_flag = miscast
						has_character_flag = dispeled
					}
				}
			}
			character_event = {
				id = tzeentch_lore.101
			}
		}
		z_spell_process_non_combat = yes
		ai_chance = {
			factor = 0
		}
	}

	option = {
		name = "CANCEL_CASTING"
		trigger = {
			event_target:magic_caster = {
				is_variable_equal = {
					which = "action_picked" which = "d_action_cancel"
				}
			}
		}
		event_target:magic_caster = {
			clr_character_flag = casting
			character_event = {
				id = magic_system.99997
			}
		}
		ai_chance = {
			factor = 10
		}
	}
}

# Combat Magic Dispel/Spell Continue
character_event = {
	id = z_spell_menu.99996
	desc = {
		trigger = {
			event_target:magic_caster = {
				not = {
					has_character_flag = dispeled
				}
			}
		}
		text = high_magic_lore.500_desc
	}
	desc = {
		trigger = {
			event_target:magic_caster = {
				has_character_flag = dispeled
			}
		}
		text = high_magic_lore.501_desc
	}
	is_triggered_only = yes
	hide_window = yes
	picture = GFX_evt_mage_lore_high_magic

	immediate = {
		log = "work event id = z_spell_menu.99996 for [Root.GetBestName]"
		event_target:magic_caster = {
			clr_character_flag = dispeled
			magic_item_proc = yes
		}
	}

	option = {
		name = high_magic_lore.501a
		character_event = {
			id = z_spell_menu.99997 days = 3
		}
	}
}

character_event = {
	id = z_spell_menu.99997# "High Magic; Soul Quench"
	desc = high_magic_lore.503
	is_triggered_only = yes
	hide_window = yes
	picture = GFX_evt_mage_lore_high_magic

	immediate = {
		log = "work event id = z_spell_menu.99997 for [Root.GetBestName]"
	}

	option = {
		name = high_magic_lore.503a
		trigger = {
			event_target:magic_caster = {
				or = {
					in_battle = yes
					in_siege = yes
				}
				check_variable = {
					which = "spell_power"
					value = "1"
				}
			}
		}
		repeat_event = {
			id = z_spell_menu.0
		}
	}

	option = {
		name = high_magic_lore.503b
		event_target:magic_caster = {
			character_event = {
				id = magic_system.99997
			}
		}
	}
}

# Non Combat Magic Spell End
character_event = {
	id = z_spell_menu.99998
	desc = z_spell_menu.99998_desc
	is_triggered_only = yes
	picture = GFX_evt_mage_choose_lore

	immediate = {
		log = "work event id = z_spell_menu.99998 for [Root.GetBestName]"
		event_target:magic_caster = {
			magic_item_proc = yes
		}
	}

	option = {
		name = z_spell_menu.99998a
		character_event = {
			id = magic_system.99997
		}
	}
}

# Non Combat Magic Spell Dispelled.
character_event = {
	id = z_spell_menu.99999# "High Magic; Soul Quench"
	desc = z_spell_menu.99999_desc# "You channel the arcane powers and lash out towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_choose_lore

	immediate = {
		log = "work event id = z_spell_menu.99999 for [Root.GetBestName]"
		event_target:magic_caster = {
			clr_character_flag = dispeled
			magic_item_proc = yes
		}
	}

	option = {
		name = z_spell_menu.99999a
		character_event = {
			id = magic_system.99997
		}
	}
}
